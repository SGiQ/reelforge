[variables]
  PLAYWRIGHT_BROWSERS_PATH = "/app/pw-browsers"

[providers]
  nixpkgs = ["python311", "ffmpeg", "nss", "nss_mdns", "libSM", "libXext", "mesa", "alsa-lib", "atk", "at-spi2-atk", "cups", "libglvnd", "libxkbcommon", "pango"]

[build]
  cmds = [
    "python -m venv .venv", 
    ". .venv/bin/activate", 
    "pip install -r requirements.txt",
    "export PLAYWRIGHT_BROWSERS_PATH=/app/pw-browsers && .venv/bin/playwright install chromium --with-deps"
  ]

[processes]
  web = "export PLAYWRIGHT_BROWSERS_PATH=/app/pw-browsers && . .venv/bin/activate && uvicorn main:app --host 0.0.0.0 --port $PORT"
  worker = "export PLAYWRIGHT_BROWSERS_PATH=/app/pw-browsers && . .venv/bin/activate && celery -A worker.celery_app worker --loglevel=info"
